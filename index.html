/**
 * LuxuryRestaurant.single.jsx
 * Single-file luxury restaurant website component (drop into Next.js or run in a React sandbox)
 *
 * Quick run:
 *  - npm install react react-dom framer-motion
 *  - In a React sandbox (Vite/CRA) import and render <LuxuryRestaurantSingle />
 *  - In Next.js place this file under /components and import into a page
 *
 * Exported:
 *  - default: LuxuryRestaurantSingle
 *  - named: mountForDemo(rootElement)
 *
 * IMPORTANT:
 *  - Replace BASE64_* placeholders with production assets (see TODO markers).
 *  - File tries to be runnable without Tailwind; includes scoped fallback CSS and a minimal Tailwind-like utility set.
 *
 * LINT NOTE:
 *  - Follows Airbnb-ish conventions where reasonable. Deliberate deviations:
 *    - Inline styles for critical animation variables to ensure single-file portability.
 *    - Some very long functions kept for single-file clarity (acceptable for this deliverable).
 */

/* ========================
   Top configuration block
   ======================== */

const CONFIG = {
  tokens: {
    color: {
      bg: '#070707',
      gold: '#C8A94F',
      cream: '#F7F3EE',
      glassLight: 'rgba(255,255,255,0.06)',
      glassDark: 'rgba(0,0,0,0.45)',
    },
    fontStack:
      "'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji'",
  },
  timings: {
    short: 160,
    medium: 320,
    long: 600,
    stagger: 80,
  },
  breakpoints: {
    sm: 640,
    md: 768,
    lg: 1024,
    xl: 1280,
  },
  placeholders: {
    // Small transparent pixel and tiny gradient as base64 placeholders for quick demo
    logo:
      'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjMyIiB2aWV3Qm94PSIwIDAgMTI4IDMyIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjx0ZXh0IHg9IjAiIHk9IjIyIiBmaWxsPSIjQzhBOUE0IiBmb250LXNpemU9IjIwIiBmb250LWZhbWlseT0iQXJpYWwiPlJlc3QgTHg8L3RleHQ+PC9zdmc+',
    heroVideo: 'data:video/mp4;base64,AAAA', // TODO: replace with real base64 video
    heroImg:
      'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBxISEhUTEhIVFhUVFRUVFRUVFRUVFRUVFRcVFRUYHSggGBolGxUVITEhJSkrLi4uFx8zODMsNygtLisBCgoKDg0OFQ8QFSsdFR0tKy0rKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tK//AABEIAOEA4QMBIgACEQEDEQH/xAAcAAEAAgMBAQEAAAAAAAAAAAAABQYDBAcCAQj/xABAEAACAQIEAwYDBgQFAwUAAAABAgADEQQSITEFBkFRYRMicYEykaGxwRRCUtHwI1JicuHh8RUzQ1Oi0uJzhCKC/8QAGgEAAwEBAQEAAAAAAAAAAAAAAwQFAgYBAP/EAC0RAAICAQMCBQMFAAAAAAAAAAABAhEDBBIhMUEFEyJRYXGBoRQyQnHB0fDx/9oADAMBAAIRAxEAPwD7kREQEREBERAREQEREBERAREQEREBERAREQERED//2Q==',
    dishPlaceholder:
      'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNzIwIiBoZWlnaHQ9IjQwMCIgdmlld0JveD0iMCAwIDcyMCA0MDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjcyMCIgaGVpZ2h0PSI0MDAiIGZpbGw9IiNmZmYiLz48dGV4dCB4PSIyMCIgeT0iMjAiIGZpbGw9IiM3Nzc3NzciIGZvbnQtc2l6ZT0iMzAiPkRJU0ggUFJFR0xBPjwvdGV4dD48L3N2Zz4=',
  },
  copy: {
    heroShort: 'Taste Precision.',
    heroLong:
      'An exacting dining experience: seasonal produce, impeccable timing, luminous technique.',
    reservationCTA: 'Reserve a Table',
    menuDescriptions: [
      'Charred octopus, lemon ash, preserved citrus.',
      'Slow-braised short rib, red wine jus, smoked salt.',
      'Vanilla panna cotta, burnt honey, citrus pearls.',
      'Chocolate terrine, sea salt, olive oil drizzle.',
      'Smoked cocktail — single-barrel infusion, orange smoke.',
      'Heirloom tomato salad, burrata, aged balsamic.',
      'Truffle potato purée, chive oil, parmesan dust.',
    ],
    reservationSuccess: 'Reservation confirmed. We await your arrival.',
    reservationFail: 'Unable to complete reservation. Check details and retry.',
    soundOn: 'Sound enabled',
    soundOff: 'Sound muted',
    themeDark: 'Dark mode',
    themeLight: 'Light mode',
  },
  performanceBudget: {
    maxInitialKB: 1500,
    maxFPSDropDev: 10,
  },
};

/* ========================
   Minimal CSS (scoped) + Tailwind-like utility subset
   ======================== */

/* Using a template literal for CSS to easily inject into a styled <style> tag when rendering */
const SCOPED_CSS = `
/* Minimal reset scoped under .lux-site to avoid global bleed */
.lux-site { box-sizing: border-box; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; font-family: ${CONFIG.tokens.fontStack}; color: ${CONFIG.tokens.color.cream}; background: ${CONFIG.tokens.color.bg}; min-height:100vh; }
.lux-site *, .lux-site *:before, .lux-site *:after { box-sizing: inherit; }
.lux-site a { color: inherit; text-decoration: none; }
.lux-site img { max-width:100%; height:auto; display:block; }
.lux-reset { margin:0; padding:0; border:0; }

/* Simple layout utilities */
.lux-container { width:100%; max-width:1200px; margin:0 auto; padding:20px; }
.lux-grid { display:grid; gap:18px; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); }
.lux-row { display:flex; gap:18px; flex-wrap:wrap; align-items:center; justify-content:space-between; }
.lux-center { display:flex; align-items:center; justify-content:center; }
.lux-hidden { display:none !important; }

/* Navbar */
.lux-navbar { position:sticky; top:0; z-index:80; backdrop-filter: blur(6px); transition:all 220ms ease; }
.lux-navbar.fixed { position:fixed; width:100%; left:0; }
.lux-nav-inner { display:flex; align-items:center; justify-content:space-between; padding:18px 24px; }
.lux-logo { display:flex; align-items:center; gap:12px; }
.lux-logo img { height:38px; width:auto; transform-origin:left center; }
.lux-nav-links { display:flex; gap:18px; align-items:center; }
.lux-nav-link { padding:8px 12px; border-radius:8px; transition:transform 160ms ease; }
.lux-nav-link:focus { outline:2px solid ${CONFIG.tokens.color.gold}; outline-offset:2px; }

/* Hero */
.lux-hero { position:relative; min-height:70vh; display:flex; align-items:center; justify-content:center; overflow:hidden; }
.lux-hero-inner { position:relative; z-index:10; max-width:1100px; padding:40px; text-align:left; }
.lux-hero .headline { font-size:clamp(28px,5vw,48px); line-height:1.02; font-weight:700; margin-bottom:14px; }
.lux-hero .sub { opacity:0.86; max-width:640px; margin-bottom:18px; }

/* Glass card */
.lux-card { background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.22)); padding:18px; border-radius:16px; box-shadow:0 6px 30px rgba(0,0,0,0.6); }

/* Menu */
.lux-tabs { display:flex; gap:12px; align-items:center; margin-bottom:18px; }
.lux-tab { padding:10px 14px; border-radius:10px; cursor:pointer; background:transparent; border:1px solid transparent; }
.lux-tab[aria-selected="true"] { background:linear-gradient(90deg, rgba(200,169,79,0.12), rgba(255,255,255,0.02)); border-color:rgba(200,169,79,0.16); }

/* Menu card */
.lux-menu-card { border-radius:14px; overflow:hidden; position:relative; transform-origin:center; cursor:pointer; transition:transform 220ms ease, box-shadow 220ms ease; }
.lux-menu-card:focus { outline:3px solid rgba(200,169,79,0.18); outline-offset:4px; }
.lux-menu-card:hover { transform:translateY(-8px) scale(1.01); box-shadow: 0 18px 40px rgba(0,0,0,0.6); }

/* Modal */
.lux-modal-backdrop { position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:200; display:flex; align-items:center; justify-content:center; }
.lux-modal { width:calc(100% - 40px); max-width:980px; border-radius:14px; overflow:hidden; }

/* Small controls */
.lux-btn { display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:10px 16px; border-radius:10px; cursor:pointer; border:1px solid rgba(255,255,255,0.04); background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.2)); }
.lux-btn.primary { background:linear-gradient(90deg, ${CONFIG.tokens.color.gold}, rgba(200,169,79,0.85)); color:${CONFIG.tokens.color.bg}; font-weight:600; }

/* Accessibility */
:focus { outline: none; }
.lux-focus-visible:focus { outline:3px solid ${CONFIG.tokens.color.gold}; outline-offset:3px; }

/* Responsive tweaks */
@media (max-width: 700px) {
  .lux-hero-inner { padding:20px; }
  .lux-navbar .lux-nav-links { display:none; }
}

/* Reduced motion respect */
@media (prefers-reduced-motion: reduce) {
  .lux-menu-card, .lux-btn, .lux-hero, .lux-modal { transition: none !important; animation: none !important; }
}
`;

/* ========================
   Utilities & Accessibility helpers
   ======================== */

/**
 * FocusTrap - small focus trap utility for modals/overlays
 * @param {HTMLElement} container
 * @returns {Object} {activate, deactivate}
 */
function createFocusTrap(container) {
  let previousActive = null;
  let handler = null;
  function activate() {
    previousActive = document.activeElement;
    const focusables = container.querySelectorAll(
      'a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])'
    );
    const first = focusables[0];
    const last = focusables[focusables.length - 1];
    if (first) first.focus();
    handler = (e) => {
      if (e.key !== 'Tab') return;
      if (focusables.length === 0) {
        e.preventDefault();
        return;
      }
      if (e.shiftKey && document.activeElement === first) {
        e.preventDefault();
        last.focus();
      } else if (!e.shiftKey && document.activeElement === last) {
        e.preventDefault();
        first.focus();
      }
    };
    document.addEventListener('keydown', handler);
  }
  function deactivate() {
    if (handler) document.removeEventListener('keydown', handler);
    if (previousActive && previousActive.focus) previousActive.focus();
  }
  return { activate, deactivate };
}

/* Minimal event emitter for analytics stub */
function analyticsEvent(name, payload = {}) {
  // Stubbed: in production route to analytics collector
  // Keep minimal and synchronous to avoid blocking
  // eslint-disable-next-line no-console
  console.log('[ANALYTICS]', name, payload);
}

/* Simple debounce */
function debounce(fn, wait = 100) {
  let t;
  return (...args) => {
    clearTimeout(t);
    t = setTimeout(() => fn(...args), wait);
  };
}

/* ========================
   Imports (assumed installed)
   ======================== */

import React, { useState, useEffect, useRef, useCallback } from 'react';
import { motion, AnimatePresence } from 'framer-motion';

/* ========================
   Asset placeholders (base64 minimal)
   ======================== */

const ASSETS = {
  logo: CONFIG.placeholders.logo,
  heroVideo: CONFIG.placeholders.heroVideo,
  heroImg: CONFIG.placeholders.heroImg,
  dishPlaceholder: CONFIG.placeholders.dishPlaceholder,
  // TODO: replace above base64 placeholders with production assets (WebP/AVIF/MP4 in /public or CDN)
};

/* ========================
   Small ARIA & Head helper for Next.js
   ======================== */

/**
 * HeadSnippet - server-side friendly head (for Next.js pages include inside <Head> manually)
 * Returns object with suggested meta tags as a comment; not injected automatically to avoid Next.js dependency.
 */
/* Suggested meta:
<title>Restaurant — Precision Dining</title>
<meta name="description" content="An exacting dining experience: seasonal produce, impeccable timing, luminous technique.">
<meta property="og:title" content="Restaurant — Precision Dining">
<meta property="og:description" content="An exacting dining experience: seasonal produce, impeccable timing, luminous technique.">
<meta property="og:image" content="/path/to/og-image.webp">
*/

/* ========================
   Subcomponents
   ======================== */

/**
 * Preloader - animated SVG logo sequence
 * Pure function component
 * @returns {JSX.Element}
 */
function Preloader({ onDone }) {
  const [visible, setVisible] = useState(true);
  useEffect(() => {
    const t = setTimeout(() => {
      setVisible(false);
      if (onDone) onDone();
    }, 850);
    return () => clearTimeout(t);
  }, [onDone]);
  return (
    <AnimatePresence>
      {visible && (
        <motion.div
          initial={{ opacity: 1 }}
          animate={{ opacity: 1 }}
          exit={{ opacity: 0 }}
          style={{
            position: 'fixed',
            inset: 0,
            zIndex: 9999,
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            background: CONFIG.tokens.color.bg,
          }}
          aria-hidden="true"
        >
          <motion.div
            initial={{ scale: 0.92 }}
            animate={{ scale: 1 }}
            transition={{ duration: 0.65, ease: 'easeOut' }}
            style={{ display: 'flex', gap: 12, alignItems: 'center' }}
          >
            <img src={ASSETS.logo} alt="logo" style={{ height: 48 }} />
            <svg width="120" height="24" viewBox="0 0 120 24" aria-hidden>
              <motion.text
                x="0"
                y="18"
                fill={CONFIG.tokens.color.gold}
                style={{ fontSize: 18, fontWeight: 700 }}
                animate={{ x: [0, 6, 0], opacity: [0.6, 1, 0.9] }}
                transition={{ repeat: Infinity, duration: 1.6 }}
              >
                LUXURY
              </motion.text>
            </svg>
          </motion.div>
        </motion.div>
      )}
    </AnimatePresence>
  );
}

/**
 * ThemeToggle - toggles dark/light theme, persisted to localStorage
 * @param {{theme:string,onToggle:function}} props
 */
function ThemeToggle({ theme, onToggle }) {
  return (
    <button
      type="button"
      aria-pressed={theme === 'dark'}
      aria-label="Toggle theme"
      className="lux-btn"
      onClick={() => {
        const next = theme === 'dark' ? 'light' : 'dark';
        onToggle(next);
        analyticsEvent('theme.toggle', { theme: next });
      }}
    >
      {theme === 'dark' ? CONFIG.copy.themeDark : CONFIG.copy.themeLight}
    </button>
  );
}

/**
 * Navbar component
 * @param {{onOpenMenu:function, compact:boolean, onSkip:string}} props
 */
function Navbar({ onOpenMenu, compact, onSkip }) {
  return (
    <header
      className={`lux-navbar ${compact ? 'fixed' : ''}`}
      role="banner"
      aria-label="Primary"
    >
      <div className="lux-nav-inner lux-container">
        <div className="lux-logo" style={{ gap: 14 }}>
          <a href="#top" onClick={(e) => e.preventDefault()}>
            <img src={ASSETS.logo} alt="Restaurant logo" />
          </a>
          <div style={{ fontSize: 14, opacity: 0.9 }}>Precision Dining</div>
        </div>

        <nav role="navigation" aria-label="Main navigation" className="lux-nav-links">
          <a className="lux-nav-link" href="#menu">Menu</a>
          <a className="lux-nav-link" href="#reservations">Reservations</a>
          <a className="lux-nav-link" href="#reviews">Reviews</a>
          <a className="lux-nav-link" href="#contact">Contact</a>
        </nav>

        <div style={{ display: 'flex', gap: 12, alignItems: 'center' }}>
          <button
            type="button"
            className="lux-btn"
            onClick={onOpenMenu}
            aria-expanded="false"
            aria-controls="mobile-nav"
            aria-label="Open menu"
          >
            Menu
          </button>
          <a href="#reservations" className="lux-btn primary">{CONFIG.copy.reservationCTA}</a>
        </div>
      </div>
    </header>
  );
}

/**
 * Hero component
 * @param {{onReserve:function, theme:string, setTheme:function}} props
 */
function Hero({ onReserve, theme, setTheme }) {
  const heroRef = useRef(null);
  const [videoSupported, setVideoSupported] = useState(false);

  useEffect(() => {
    // Detect basic MP4 support
    const v = document.createElement('video');
    setVideoSupported(!!v.canPlayType && !!v.canPlayType('video/mp4').replace(/no/, ''));
  }, []);

  const handleCta = () => {
    analyticsEvent('cta.reserve.hero');
    onReserve();
  };

  return (
    <section id="top" className="lux-hero" ref={heroRef} role="region" aria-label="Hero">
      {/* Background layers */}
      <div aria-hidden style={{ position: 'absolute', inset: 0 }}>
        {videoSupported ? (
          <video
            autoPlay
            muted
            loop
            playsInline
            src={ASSETS.heroVideo}
            style={{ width: '100%', height: '100%', objectFit: 'cover', filter: 'brightness(0.46)' }}
          />
        ) : (
          <picture>
            <source srcSet={ASSETS.heroImg} type="image/jpeg" />
            <img src={ASSETS.heroImg} alt="" aria-hidden style={{ width: '100%', height: '100%', objectFit: 'cover' }} />
          </picture>
        )}
        <div style={{ position: 'absolute', inset: 0, background: 'linear-gradient(180deg, rgba(7,7,7,0.25), rgba(7,7,7,0.6))' }} />
      </div>

      <div className="lux-hero-inner lux-container">
        <div className="lux-card" style={{ maxWidth: 780 }}>
          <motion.h1
            className="headline"
            initial={{ y: 18, opacity: 0 }}
            animate={{ y: 0, opacity: 1 }}
            transition={{ duration: CONFIG.timings.medium / 1000, delay: 0.06 }}
          >
            {CONFIG.copy.heroShort}
          </motion.h1>
          <motion.p
            className="sub"
            initial={{ y: 18, opacity: 0 }}
            animate={{ y: 0, opacity: 1 }}
            transition={{ duration: CONFIG.timings.medium / 1000, delay: 0.18 }}
          >
            {CONFIG.copy.heroLong}
          </motion.p>

          <div style={{ display: 'flex', gap: 12 }}>
            <button type="button" className="lux-btn primary" onClick={handleCta}>
              {CONFIG.copy.reservationCTA}
            </button>
            <ThemeToggle theme={theme} onToggle={setTheme} />
          </div>
        </div>
      </div>
    </section>
  );
}

/**
 * MenuCard - an interactive card for each menu item
 * @param {{item:object, onOpen:function}} props
 */
function MenuCard({ item, onOpen }) {
  const cardRef = useRef(null);

  // 3D tilt effect
  useEffect(() => {
    const el = cardRef.current;
    if (!el) return;
    function onMove(e) {
      const rect = el.getBoundingClientRect();
      const x = (e.clientX - rect.left - rect.width / 2) / rect.width;
      const y = (e.clientY - rect.top - rect.height / 2) / rect.height;
      el.style.transform = `perspective(800px) translateZ(0) rotateX(${ -y * 6 }deg) rotateY(${ x * 6 }deg) translateY(-6px)`;
    }
    function onLeave() {
      el.style.transform = '';
    }
    el.addEventListener('mousemove', onMove);
    el.addEventListener('mouseleave', onLeave);
    return () => {
      el.removeEventListener('mousemove', onMove);
      el.removeEventListener('mouseleave', onLeave);
    };
  }, []);

  return (
    <div
      ref={cardRef}
      className="lux-menu-card lux-card"
      role="button"
      tabIndex={0}
      aria-label={`${item.title} — ${item.price}`}
      onClick={() => onOpen(item)}
      onKeyDown={(e) => {
        if (e.key === 'Enter' || e.key === ' ') onOpen(item);
      }}
    >
      <div style={{ display: 'grid', gridTemplateColumns: '140px 1fr', gap: 12 }}>
        <div style={{ borderRadius: 12, overflow: 'hidden' }}>
          <img src={item.image || ASSETS.dishPlaceholder} alt={item.title} loading="lazy" />
        </div>
        <div>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
            <div>
              <div style={{ fontSize: 16, fontWeight: 700 }}>{item.title}</div>
              <div style={{ fontSize: 13, opacity: 0.85 }}>{item.subtitle}</div>
            </div>
            <div style={{ fontWeight: 700 }}>{item.price}</div>
          </div>
          <div style={{ marginTop: 12, fontSize: 13, opacity: 0.85 }}>{item.desc}</div>
        </div>
      </div>
    </div>
  );
}

/**
 * Menu - container with category tabs and animated content
 * @param {{items:object[], onOpen:function}} props
 */
function Menu({ items, onOpen }) {
  const categories = ['Dishes', 'Desserts', 'Drinks'];
  const [active, setActive] = useState('Dishes');

  const filtered = items.filter((i) => i.category === active);
  return (
    <section id="menu" className="lux-container" aria-labelledby="menu-heading">
      <h2 id="menu-heading" style={{ fontSize: 20, marginBottom: 12 }}>Menu</h2>
      <div className="lux-tabs" role="tablist" aria-label="Menu categories">
        {categories.map((c) => (
          <button
            key={c}
            role="tab"
            aria-selected={active === c}
            className="lux-tab lux-btn"
            onClick={() => setActive(c)}
          >
            {c}
          </button>
        ))}
      </div>

      <motion.div layout className="lux-grid" key={active}>
        <AnimatePresence>
          {filtered.map((it) => (
            <motion.div
              key={it.id}
              initial={{ opacity: 0, y: 8 }}
              animate={{ opacity: 1, y: 0 }}
              exit={{ opacity: 0, y: 8 }}
              transition={{ duration: 0.28 }}
            >
              <MenuCard item={it} onOpen={onOpen} />
            </motion.div>
          ))}
        </AnimatePresence>
      </motion.div>
    </section>
  );
}

/**
 * Modal full-screen dish detail
 * @param {{item:object, onClose:function}} props
 */
function Modal({ item, onClose }) {
  const backdropRef = useRef(null);

  useEffect(() => {
    const trap = createFocusTrap(backdropRef.current);
    trap.activate();
    function onKey(e) {
      if (e.key === 'Escape') onClose();
    }
    document.addEventListener('keydown', onKey);
    return () => {
      document.removeEventListener('keydown', onKey);
      trap.deactivate();
    };
  }, [onClose]);

  if (!item) return null;

  return (
    <div className="lux-modal-backdrop" role="dialog" aria-modal="true" ref={backdropRef}>
      <motion.div
        className="lux-modal lux-card"
        initial={{ scale: 0.96, opacity: 0 }}
        animate={{ scale: 1, opacity: 1 }}
        exit={{ scale: 0.96, opacity: 0 }}
      >
        <div style={{ display: 'grid', gridTemplateColumns: '1fr 420px', gap: 12 }}>
          <div style={{ minHeight: 320, position: 'relative' }}>
            <img src={item.image || ASSETS.dishPlaceholder} alt={item.title} style={{ width: '100%', height: '100%', objectFit: 'cover' }} />
            {/* Steam micro-animation */}
            <svg style={{ position: 'absolute', right: 12, top: 12 }} width="84" height="84" aria-hidden>
              <g fill="none" stroke={CONFIG.tokens.color.cream} strokeOpacity="0.06">
                <path d="M10 70 C20 50, 40 50, 50 30" strokeWidth="2">
                  <animate attributeName="stroke-opacity" values="0.06;0.18;0.06" dur="2s" repeatCount="indefinite" />
                </path>
              </g>
            </svg>
          </div>

          <div style={{ padding: 18 }}>
            <div style={{ display: 'flex', justifyContent: 'space-between' }}>
              <div>
                <h3 style={{ margin: 0 }}>{item.title}</h3>
                <div style={{ opacity: 0.8 }}>{item.subtitle}</div>
              </div>
              <div style={{ fontSize: 18, fontWeight: 700 }}>{item.price}</div>
            </div>

            <p style={{ marginTop: 12 }}>{item.desc}</p>

            <div style={{ marginTop: 12 }}>
              <strong>Ingredients</strong>
              <ul>
                {item.ingredients.map((ing) => (
                  // eslint-disable-next-line react/no-array-index-key
                  <li key={ing}>{ing}</li>
                ))}
              </ul>
            </div>

            <div style={{ marginTop: 12, display: 'flex', gap: 8 }}>
              <label>
                Qty
                <select defaultValue="1" style={{ marginLeft: 8 }}>
                  <option>1</option>
                  <option>2</option>
                  <option>3</option>
                </select>
              </label>

              <button className="lux-btn primary" onClick={() => { analyticsEvent('menu.add_to_cart', { id: item.id }); }}>
                Add / Reserve
              </button>

              <button className="lux-btn" onClick={onClose} aria-label="Close dialog">Close</button>
            </div>
          </div>
        </div>
      </motion.div>
    </div>
  );
}

/**
 * ReservationForm - inline calendar/time picker with validation (mock submit)
 * @param {{onClose:function}} props
 */
function ReservationForm({ onClose }) {
  const [date, setDate] = useState(() => {
    const d = new Date();
    d.setDate(d.getDate() + 1);
    return d.toISOString().slice(0, 10);
  });
  const [time, setTime] = useState('19:00');
  const [name, setName] = useState('');
  const [seats, setSeats] = useState(2);
  const [loading, setLoading] = useState(false);
  const [msg, setMsg] = useState(null);

  function validate() {
    if (!name.trim()) return 'Name required';
    if (!date) return 'Date required';
    return null;
  }

  async function submit(e) {
    e.preventDefault();
    const err = validate();
    if (err) { setMsg({ type: 'error', text: err }); return; }
    setLoading(true);
    analyticsEvent('reservation.attempt', { date, time, name, seats });
    // Mocked server call
    await new Promise((r) => setTimeout(r, 800));
    const success = Math.random() > 0.06; // occasional fail for demo
    setLoading(false);
    if (success) {
      setMsg({ type: 'success', text: CONFIG.copy.reservationSuccess });
      analyticsEvent('reservation.success', { date, time, name, seats });
      setTimeout(() => onClose(), 900);
    } else {
      setMsg({ type: 'error', text: CONFIG.copy.reservationFail });
      analyticsEvent('reservation.fail', { date, time, name, seats });
    }
  }

  return (
    <form onSubmit={submit} className="lux-card" style={{ maxWidth: 540 }}>
      <h3 style={{ marginTop: 0 }}>Reserve</h3>
      <div style={{ display: 'grid', gap: 8 }}>
        <label>
          Name
          <input value={name} onChange={(e) => setName(e.target.value)} style={{ width: '100%', padding: 8, marginTop: 6 }} required />
        </label>

        <div style={{ display: 'flex', gap: 8 }}>
          <label>
            Date
            <input type="date" value={date} onChange={(e) => setDate(e.target.value)} required style={{ padding: 8, marginTop: 6 }} />
          </label>
          <label>
            Time
            <input type="time" value={time} onChange={(e) => setTime(e.target.value)} required style={{ padding: 8, marginTop: 6 }} />
          </label>
          <label>
            Seats
            <select value={seats} onChange={(e) => setSeats(Number(e.target.value))} style={{ padding: 8, marginTop: 6 }}>
              <option>1</option>
              <option>2</option>
              <option>3</option>
              <option>4</option>
            </select>
          </label>
        </div>

        {msg && (
          <div style={{ padding: 8, borderRadius: 8, background: msg.type === 'error' ? 'rgba(255,0,0,0.06)' : 'rgba(0,200,100,0.06)' }}>
            {msg.text}
          </div>
        )}

        <div style={{ display: 'flex', gap: 8 }}>
          <button type="submit" className="lux-btn primary" disabled={loading}>
            {loading ? 'Booking…' : 'Confirm Reservation'}
          </button>
          <button type="button" className="lux-btn" onClick={onClose}>Cancel</button>
        </div>
      </div>
    </form>
  );
}

/**
 * ReviewsCarousel - swipe-enabled carousel with autoplay
 * @param {{reviews:object[]}} props
 */
function ReviewsCarousel({ reviews = [] }) {
  const [index, setIndex] = useState(0);
  const intervalRef = useRef(null);
  const containerRef = useRef(null);

  useEffect(() => {
    function start() {
      intervalRef.current = setInterval(() => {
        setIndex((i) => (i + 1) % reviews.length);
      }, 4200);
    }
    function stop() {
      clearInterval(intervalRef.current);
    }
    start();
    containerRef.current?.addEventListener('mouseenter', stop);
    containerRef.current?.addEventListener('mouseleave', start);
    return () => {
      stop();
      containerRef.current?.removeEventListener('mouseenter', stop);
      containerRef.current?.removeEventListener('mouseleave', start);
    };
  }, [reviews.length]);

  function prev() { setIndex((i) => (i - 1 + reviews.length) % reviews.length); }
  function next() { setIndex((i) => (i + 1) % reviews.length); }

  return (
    <div id="reviews" className="lux-container" aria-label="Customer reviews">
      <h3>Reviews</h3>
      <div ref={containerRef} style={{ position: 'relative' }}>
        <div style={{ minHeight: 120 }}>
          <AnimatePresence>
            <motion.div
              key={index}
              initial={{ opacity: 0, x: 16 }}
              animate={{ opacity: 1, x: 0 }}
              exit={{ opacity: 0, x: -16 }}
              transition={{ duration: 0.36 }}
              className="lux-card"
            >
              <blockquote style={{ margin: 0 }}>
                <p style={{ fontSize: 16 }}>{reviews[index]?.text}</p>
                <footer style={{ marginTop: 10, opacity: 0.9 }}>— {reviews[index]?.author}</footer>
              </blockquote>
            </motion.div>
          </AnimatePresence>
        </div>

        <div style={{ display: 'flex', gap: 8, marginTop: 8 }}>
          <button className="lux-btn" onClick={prev} aria-label="Previous review">Prev</button>
          <button className="lux-btn" onClick={next} aria-label="Next review">Next</button>
        </div>
      </div>
    </div>
  );
}

/**
 * DrinkVisualizer - interactive cocktail visualizer (SVG mask fill)
 * @param {{drinks:object[]}} props
 */
function DrinkVisualizer({ drinks = [] }) {
  const [selected, setSelected] = useState(drinks[0] || null);
  const [pouring, setPouring] = useState(false);

  function togglePour() {
    setPouring((p) => !p);
    analyticsEvent('drink.pour', { id: selected?.id, pouring: !pouring });
  }

  return (
    <section className="lux-container" aria-label="Drink visualizer">
      <h3>Mix</h3>
      <div style={{ display: 'flex', gap: 12, alignItems: 'center' }}>
        <div style={{ width: 220, height: 300 }} className="lux-card">
          <svg viewBox="0 0 200 260" style={{ width: '100%', height: '100%' }} aria-hidden>
            <defs>
              <linearGradient id="liquid" x1="0" x2="0" y1="0" y2="1">
                <stop offset="0%" stopColor={CONFIG.tokens.color.gold} stopOpacity="0.9" />
                <stop offset="100%" stopColor="#f6eab7" stopOpacity="0.6" />
              </linearGradient>
              <clipPath id="glass">
                <path d="M40 30 h120 v170 q0 20 -20 20 h-80 q-20 0 -20 -20 z" />
              </clipPath>
            </defs>
            <g clipPath="url(#glass)">
              <rect x="0" y={pouring ? 40 : 140} width="200" height="260" fill="url(#liquid)">
                <animate attributeName="y" from={pouring ? 140 : 40} to={pouring ? 40 : 140} dur="1.2s" fill="freeze" />
              </rect>
            </g>
            <path d="M40 30 h120 v170 q0 20 -20 20 h-80 q-20 0 -20 -20 z" fill="none" stroke="rgba(255,255,255,0.06)" strokeWidth="2" />
          </svg>
        </div>

        <div style={{ display: 'flex', flexDirection: 'column', gap: 8 }}>
          <select value={selected?.id} onChange={(e) => setSelected(drinks.find((d) => d.id === e.target.value))}>
            {drinks.map((d) => <option key={d.id} value={d.id}>{d.title}</option>)}
          </select>
          <div style={{ opacity: 0.92 }}>{selected?.desc}</div>
          <div style={{ display: 'flex', gap: 8 }}>
            <button className="lux-btn" onClick={togglePour}>{pouring ? 'Stop' : 'Pour'}</button>
            <button className="lux-btn" onClick={() => analyticsEvent('drink.select', { id: selected?.id })}>Add to order</button>
          </div>
        </div>
      </div>
    </section>
  );
}

/**
 * Timeline - horizontal drag-to-scroll timeline for restaurant history
 * @param {{events:object[]}} props
 */
function Timeline({ events = [] }) {
  const ref = useRef(null);
  const [dragging, setDragging] = useState(false);
  useEffect(() => {
    const el = ref.current;
    if (!el) return;
    let isDown = false;
    let startX;
    let scrollLeft;
    function onDown(e) {
      isDown = true;
      el.classList.add('active');
      startX = e.pageX - el.offsetLeft;
      scrollLeft = el.scrollLeft;
      setDragging(true);
    }
    function onUp() {
      isDown = false;
      el.classList.remove('active');
      setDragging(false);
    }
    function onMove(e) {
      if (!isDown) return;
      e.preventDefault();
      const x = e.pageX - el.offsetLeft;
      const walk = (x - startX) * 1.4;
      el.scrollLeft = scrollLeft - walk;
    }
    el.addEventListener('mousedown', onDown);
    window.addEventListener('mouseup', onUp);
    el.addEventListener('mousemove', onMove);
    return () => {
      el.removeEventListener('mousedown', onDown);
      window.removeEventListener('mouseup', onUp);
      el.removeEventListener('mousemove', onMove);
    };
  }, []);
  return (
    <section className="lux-container" aria-label="History timeline">
      <h3>Our Story</h3>
      <div ref={ref} style={{ display: 'flex', gap: 12, overflowX: 'auto', padding: 12 }}>
        {events.map((ev) => (
          <article key={ev.year} className="lux-card" style={{ minWidth: 240 }}>
            <div style={{ fontWeight: 700 }}>{ev.year}</div>
            <div style={{ opacity: 0.9 }}>{ev.title}</div>
            <div style={{ marginTop: 8, fontSize: 13 }}>{ev.text}</div>
          </article>
        ))}
      </div>
      <div style={{ marginTop: 8, opacity: 0.8, fontSize: 13 }}>{dragging ? 'Dragging timeline' : 'Drag or use arrows to navigate'}</div>
    </section>
  );
}

/**
 * Contact section with form & map placeholder
 * @returns {JSX.Element}
 */
function Contact() {
  const [msg, setMsg] = useState(null);
  function submit(e) {
    e.preventDefault();
    setMsg('Message sent (mock). We will reply shortly.');
    analyticsEvent('contact.submit');
    setTimeout(() => setMsg(null), 2400);
  }
  return (
    <section id="contact" className="lux-container" aria-label="Contact">
      <h3>Contact</h3>
      <div style={{ display: 'grid', gridTemplateColumns: '1fr 320px', gap: 18 }}>
        <form className="lux-card" onSubmit={submit}>
          <label>
            Your name
            <input required style={{ width: '100%', padding: 8, marginTop: 6 }} />
          </label>
          <label>
            Email
            <input type="email" required style={{ width: '100%', padding: 8, marginTop: 6 }} />
          </label>
          <label>
            Message
            <textarea required style={{ width: '100%', padding: 8, marginTop: 6 }} rows="4" />
          </label>
          {msg && <div style={{ marginTop: 8 }}>{msg}</div>}
          <div style={{ display: 'flex', gap: 8, marginTop: 12 }}>
            <button type="submit" className="lux-btn primary">Send</button>
            <button type="button" className="lux-btn">Clear</button>
          </div>
        </form>

        <div className="lux-card" style={{ minHeight: 260 }}>
          <div style={{ fontWeight: 700, marginBottom: 6 }}>Find us</div>
          <div style={{ marginBottom: 12, opacity: 0.85 }}>123 Precision Lane, Culinary City</div>
          {/* Map placeholder */}
          <div style={{ background: 'linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.08))', height: 180, borderRadius: 12 }} aria-hidden>
            <img src={ASSETS.heroImg} alt="" style={{ width: '100%', height: '100%', objectFit: 'cover', opacity: 0.45 }} />
          </div>

          <div style={{ display: 'flex', gap: 8, marginTop: 12 }}>
            <a className="lux-btn" href="#map" aria-label="Open map">Open Map</a>
            <a className="lux-btn" href="tel:+123456789" aria-label="Call">Call</a>
          </div>
        </div>
      </div>
    </section>
  );
}

/**
 * Footer
 */
function Footer() {
  return (
    <footer className="lux-container" style={{ paddingTop: 32, paddingBottom: 40 }}>
      <div style={{ display: 'flex', gap: 12, alignItems: 'center', justifyContent: 'space-between' }}>
        <div style={{ opacity: 0.9 }}>© {new Date().getFullYear()} Precision Dining</div>
        <div style={{ display: 'flex', gap: 8 }}>
          <a className="lux-btn" href="#privacy">Privacy</a>
          <a className="lux-btn" href="#terms">Terms</a>
        </div>
      </div>
    </footer>
  );
}

/* ========================
   Main export component
   ======================== */

/**
 * LuxuryRestaurantSingle - main single-file component
 * @returns {JSX.Element}
 */
export default function LuxuryRestaurantSingle() {
  // Theme
  const [theme, setTheme] = useState(() => {
    try {
      return localStorage.getItem('lux:theme') || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'dark');
    } catch (e) {
      return 'dark';
    }
  });
  useEffect(() => {
    try { localStorage.setItem('lux:theme', theme); } catch (e) {}
    document.documentElement.style.background = CONFIG.tokens.color.bg;
    document.documentElement.style.color = CONFIG.tokens.color.cream;
  }, [theme]);

  // Preloader
  const [loadingDone, setLoadingDone] = useState(false);

  // Navbar compact on scroll
  const [compact, setCompact] = useState(false);
  useEffect(() => {
    const onScroll = debounce(() => {
      setCompact(window.scrollY > 80);
    }, 60);
    window.addEventListener('scroll', onScroll);
    return () => window.removeEventListener('scroll', onScroll);
  }, []);

  // Modal state
  const [activeItem, setActiveItem] = useState(null);
  const [reservationOpen, setReservationOpen] = useState(false);

  // Sample items (would come from CMS/API)
  const sampleItems = [
    {
      id: 'd1',
      category: 'Dishes',
      title: 'Charred Octopus',
      subtitle: 'Lemon ash, preserved citrus',
      price: '€26',
      desc: CONFIG.copy.menuDescriptions[0],
      image: ASSETS.dishPlaceholder,
      ingredients: ['Octopus', 'Lemon', 'Preserved citrus', 'Olive oil'],
    },
    {
      id: 'd2',
      category: 'Dishes',
      title: 'Short Rib',
      subtitle: 'Red wine jus, smoked salt',
      price: '€34',
      desc: CONFIG.copy.menuDescriptions[1],
      image: ASSETS.dishPlaceholder,
      ingredients: ['Beef short rib', 'Red wine', 'Smoked salt'],
    },
    {
      id: 'des1',
      category: 'Desserts',
      title: 'Panna Cotta',
      subtitle: 'Burnt honey, citrus pearls',
      price: '€12',
      desc: CONFIG.copy.menuDescriptions[2],
      image: ASSETS.dishPlaceholder,
      ingredients: ['Cream', 'Honey', 'Citrus'],
    },
    {
      id: 'dr1',
      category: 'Drinks',
      title: 'Smoked Martini',
      subtitle: 'Single-barrel infusion',
      price: '€16',
      desc: CONFIG.copy.menuDescriptions[4],
      image: ASSETS.dishPlaceholder,
      ingredients: ['Gin', 'Vermouth', 'Smoke'],
    },
  ];

  const reviews = [
    { author: 'A. Teller', text: 'Exact timing, brilliant execution. Every plate mattered.' },
    { author: 'M. Rivers', text: 'Cuisine with clarity. The tasting menu shifted my expectations.' },
    { author: 'S. Lin', text: 'Service precise, flavors bright, drinks exceptional.' },
  ];

  const drinks = [
    { id: 'c1', title: 'Golden Old Fashion', desc: 'Barrel-aged, citrus smoke.' },
    { id: 'c2', title: 'Nocturne Martini', desc: 'Dry, aromatic, chilled.' },
  ];

  const events = [
    { year: '2016', title: 'Founding', text: 'Opened doors with a single tasting menu.' },
    { year: '2018', title: 'First Michelin', text: 'Recognized for technique and produce' },
    { year: '2021', title: 'Expansion', text: 'New private dining salon.' },
  ];

  // Audio SFX control
  const [soundOn, setSoundOn] = useState(() => {
    try { return localStorage.getItem('lux:sound') !== '0'; } catch (e) { return true; }
  });
  useEffect(() => {
    try { localStorage.setItem('lux:sound', soundOn ? '1' : '0'); } catch (e) {}
  }, [soundOn]);

  // Simple audio playback
  function playSfx() {
    if (!soundOn) return;
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.type = 'sine';
    o.frequency.value = 520;
    g.gain.value = 0.02;
    o.connect(g);
    g.connect(ctx.destination);
    o.start();
    setTimeout(() => { o.stop(); ctx.close(); }, 120);
  }

  // Performance telemetry (dev mode)
  useEffect(() => {
    if (process.env.NODE_ENV === 'development') {
      let last = performance.now();
      function frameCheck() {
        const now = performance.now();
        const delta = now - last;
        last = now;
        if (delta > 34) { // ~30fps drop
          // eslint-disable-next-line no-console
          console.warn('Frame drop detected:', Math.round(delta));
        }
        requestAnimationFrame(frameCheck);
      }
      const t = requestAnimationFrame(frameCheck);
      return () => cancelAnimationFrame(t);
    }
    return undefined;
  }, []);

  // Insert scoped CSS
  useEffect(() => {
    let el = document.getElementById('lux-scoped-styles');
    if (!el) {
      el = document.createElement('style');
      el.id = 'lux-scoped-styles';
      el.textContent = SCOPED_CSS;
      document.head.appendChild(el);
    }
  }, []);

  return (
    <div className="lux-site" role="application">
      <a href="#menu" className="lux-hidden" style={{ position: 'absolute' }}>Skip to menu</a>
      {!loadingDone && <Preloader onDone={() => setLoadingDone(true)} />}

      <Navbar
        onOpenMenu={() => { analyticsEvent('nav.open'); alert('Mobile menu demo (not fully implemented in single-file demo).'); }}
        compact={compact}
      />

      <main>
        <Hero
          onReserve={() => { setReservationOpen(true); analyticsEvent('open.reservation'); playSfx(); }}
          theme={theme}
          setTheme={(t) => setTheme(t)}
        />

        <Menu items={sampleItems} onOpen={(it) => { setActiveItem(it); analyticsEvent('menu.open', { id: it.id }); playSfx(); }} />

        <div className="lux-container" style={{ marginTop: 28 }}>
          <DrinkVisualizer drinks={drinks} />
        </div>

        <ReviewsCarousel reviews={reviews} />

        <Timeline events={events} />

        <section className="lux-container" aria-label="Reserve">
          <h3 id="reservations">Reservations</h3>
          <p style={{ opacity: 0.9 }}>Book a table. We hold limited seating to preserve timing.</p>
          <div style={{ marginTop: 12 }}>
            <button className="lux-btn primary" onClick={() => { setReservationOpen(true); analyticsEvent('reservation.open'); }}>{CONFIG.copy.reservationCTA}</button>
            <button className="lux-btn" onClick={() => { setSoundOn((s) => !s); }}>{soundOn ? CONFIG.copy.soundOn : CONFIG.copy.soundOff}</button>
          </div>
        </section>

        <Contact />

        <Footer />
      </main>

      <AnimatePresence>
        {activeItem && (
          <Modal
            key="modal"
            item={activeItem}
            onClose={() => { setActiveItem(null); analyticsEvent('modal.close'); }}
          />
        )}
      </AnimatePresence>

      <AnimatePresence>
        {reservationOpen && (
          <motion.div
            className="lux-modal-backdrop"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            role="dialog"
            aria-modal="true"
          >
            <motion.div initial={{ y: 20, opacity: 0 }} animate={{ y: 0, opacity: 1 }} exit={{ y: 20, opacity: 0 }}>
              <ReservationForm onClose={() => setReservationOpen(false)} />
            </motion.div>
          </motion.div>
        )}
      </AnimatePresence>

      {/* Cookie / Consent placeholder */}
      <div style={{ position: 'fixed', right: 16, bottom: 16, zIndex: 60 }}>
        <div className="lux-card" style={{ display: 'flex', gap: 8, alignItems: 'center' }}>
          <div style={{ fontSize: 13 }}>We use minimal cookies for preferences. No third-party trackers enabled.</div>
          <button className="lux-btn" onClick={() => { alert('Cookie consent stored (demo)'); }}>Acknowledge</button>
        </div>
      </div>
    </div>
  );
}

/* ========================
   Demo mount helper and test harness
   ======================== */

/**
 * mountForDemo - mounts component into a plain HTML element
 * @param {HTMLElement} rootElement
 */
export function mountForDemo(rootElement) {
  // Basic mounting without bundler-specific APIs
  // eslint-disable-next-line global-require
  const ReactDOM = require('react-dom');
  ReactDOM.render(React.createElement(LuxuryRestaurantSingle), rootElement);
}

/* ========================
   Testing examples / guidance (commented)
   ======================== */

/*
Playwright / Cypress critical path examples (copy into test files):

1) Reservation flow:
- Visit page
- Click Reserve CTA
- Fill name, pick date/time, submit
- Assert success message shown

2) Menu modal keyboard:
- Tab to a menu card
- Press Enter
- Modal opens and focus trapped
- Press Escape to close

3) Accessibility:
- Run axe-core against rendered page
- Ensure no high-severity violations

Cypress example (pseudocode):
describe('Reservation', () => {
  it('can make a mock reservation', () => {
    cy.visit('/');
    cy.contains('Reserve a Table').click();
    cy.get('input[name="name"]').type('Test User');
    cy.get('input[type="date"]').clear().type('2025-12-01');
    cy.get('button').contains('Confirm Reservation').click();
    cy.contains('Reservation confirmed');
  });
});
*/

/* ========================
   Build to production notes
   ======================== */

export const buildNotesDetailed = `
- Replace all BASE64 placeholders with optimized WebP/AVIF/MP4 assets in /public.
- Enable Tailwind JIT: add tailwind.config.js and import the component classes via purge.
- Extract CSS into global stylesheet for performance; remove scoped style injection.
- Move analyticsEvent to server endpoint or tag manager.
- Setup reservations API endpoint; swap mocked call in ReservationForm with fetch POST and proper error handling.
- Add image srcSet and sizes for responsive images; convert to next/image for Next.js production.
- Use video poster and progressive streaming (HLS) for hero video if large.
`;

/* ========================
   Accessibility checklist (comment)
   ========================
- All interactive elements keyboard accessible.
- Modal uses focus trap and ESC closes.
- Focus visible styles present.
- ARIA roles for dialog, navigation, tablist.
- Color contrast checked for primary text vs background.
- Reduced-motion respected via CSS media query.
- Provide alt text for all images; decorative images marked with aria-hidden / empty alt.
*/

/* End of single-file component */
